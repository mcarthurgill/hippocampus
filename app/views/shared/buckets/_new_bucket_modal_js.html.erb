<script>
// -------------------------------- Settings --------------------------------
// Rapid Input Field:
var rapidInput = $('#new-bucket-input');
var saveBucket = $('#save_bucket');
var cancelBucket = $('#cancel_bucket');

var bucketTemplate = "<%= escape_javascript(render partial: 'shared/buckets/bucket_template') %>";

// ---------------------------------- Events ----------------------------------
rapidInput.keydown(function(e){
    // ------------------------------ Enter Key -------------------------------
    if (e.keyCode == 13 && !e.shiftKey)
    { 
      saveAndResetBucket(e); 
    }
});

saveBucket.click(function(e){
  saveAndResetBucket(e); 
});
// ---------------------------------- Events ----------------------------------
cancelBucket.click(function(e){
  rapidInput.val("");
});

function saveAndResetBucket(e){
  e.preventDefault();

  if (rapidInput.val()) {
    var bucketName = rapidInput.val();
    submitBucketWithTemplate(bucketTemplate)
    // -------------------------- Reset/Clear ---------------------------
    rapidInput.val("");
    $("#cancel_bucket").click(); 
  }   
}

function submit() {
  $("#new_bucket").submit();
}

function submitBucketWithTemplate(template) {
  submit();
  appendBucketWithTemplate(template);
}

function appendBucketWithTemplate(template) {
  var $jQueryObject = $($.parseHTML(template));
  $jQueryObject.find('#bucket-firstname').html($("#new-bucket-input").val())
  $("#bucket-list").prepend($jQueryObject);
}
</script>